"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.setupPollyJestCircus = setupPollyJestCircus;

var _globals = require("@jest/globals");

var _common = require("./common");

// @ts-check

/**
 * @typedef {import('@pollyjs/core').PollyConfig} PollyConfig
 */

/**
 * @param {PollyConfig} defaults
 * @param {unknown | undefined} ctx
 *
 * @returns {ReturnType<typeof createPollyContextAccessor>}
 */
function setupPollyJestCircus(defaults = {}, ctx) {
  const globals = new _common.JestPollyGlobals(ctx);

  if (!globals.isJestPollyEnvironment) {
    return;
  }

  (0, _globals.beforeAll)(() => {
    globals.isPollyActive = true;
    globals.pollyContext.options = defaults;
  });
  (0, _globals.afterAll)(() => {
    globals.isPollyActive = false;
    globals.pollyContext.options = null;
  });
  return (0, _common.createPollyContextAccessor)(globals);
}