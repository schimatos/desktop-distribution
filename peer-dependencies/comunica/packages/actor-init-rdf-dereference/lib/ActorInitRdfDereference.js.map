{"version":3,"file":"ActorInitRdfDereference.js","sourceRoot":"","sources":["ActorInitRdfDereference.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA,mCAAkC;AAElC,iDAA+C;AAI/C,sDAAwC;AAExC;;;;;GAKG;AACH,MAAa,uBAAwB,SAAQ,oBAAS;IAMpD,YAAmB,IAA4B;QAC7C,KAAK,CAAC,IAAI,CAAC,CAAC;IACd,CAAC;IAEM,KAAK,CAAC,IAAI,CAAC,MAAmB;QACnC,OAAO,IAAI,CAAC;IACd,CAAC;IAEM,KAAK,CAAC,GAAG,CAAC,MAAmB;;QAClC,MAAM,WAAW,GAA0B;YACzC,OAAO,EAAE,MAAM,CAAC,OAAO;YACvB,GAAG,EAAE,MAAM,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,OAAC,IAAI,CAAC,GAAG,mCAAI,EAAE;SAC9D,CAAC;QACF,IAAI,CAAC,WAAW,CAAC,GAAG,EAAE;YACpB,MAAM,IAAI,KAAK,CAAC,wDAAwD,CAAC,CAAC;SAC3E;QACD,MAAM,MAAM,GAAyB,MAAM,IAAI,CAAC,sBAAsB,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;QAE5F,MAAM,QAAQ,GAAG,IAAI,iBAAQ,EAAE,CAAC;QAChC,QAAQ,CAAC,KAAK,GAAG,GAAG,EAAE;YACpB,aAAa;QACf,CAAC,CAAC;QACF,MAAM,CAAC,KAAK,CAAC,EAAE,CAAC,MAAM,EAAE,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;QACxG,MAAM,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,EAAE,GAAG,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QAElD,OAAO,EAAE,MAAM,EAAE,QAAQ,EAAE,CAAC;IAC9B,CAAC;CACF;AAjCD,0DAiCC","sourcesContent":["import { Readable } from 'stream';\nimport type { IActionInit, IActorOutputInit } from '@comunica/bus-init';\nimport { ActorInit } from '@comunica/bus-init';\nimport type { IActionRdfDereference, IActorRdfDereferenceOutput } from '@comunica/bus-rdf-dereference';\nimport type { IActorRdfParseOutput } from '@comunica/bus-rdf-parse';\nimport type { Actor, IActorArgs, IActorTest, Mediator } from '@comunica/core';\nimport * as RdfString from 'rdf-string';\n\n/**\n * An RDF Parse actor that listens on the 'init' bus.\n *\n * It requires a mediator that is defined over the 'rdf-parse' bus,\n * and a mediaType that identifies the RDF serialization.\n */\nexport class ActorInitRdfDereference extends ActorInit implements IActorInitRdfParseArgs {\n  public readonly mediatorRdfDereference: Mediator<Actor<IActionRdfDereference, IActorTest, IActorRdfDereferenceOutput>,\n  IActionRdfDereference, IActorTest, IActorRdfDereferenceOutput>;\n\n  public readonly url?: string;\n\n  public constructor(args: IActorInitRdfParseArgs) {\n    super(args);\n  }\n\n  public async test(action: IActionInit): Promise<IActorTest> {\n    return true;\n  }\n\n  public async run(action: IActionInit): Promise<IActorOutputInit> {\n    const dereference: IActionRdfDereference = {\n      context: action.context,\n      url: action.argv.length > 0 ? action.argv[0] : this.url ?? '',\n    };\n    if (!dereference.url) {\n      throw new Error('A URL must be given either in the config or as CLI arg');\n    }\n    const result: IActorRdfParseOutput = await this.mediatorRdfDereference.mediate(dereference);\n\n    const readable = new Readable();\n    readable._read = () => {\n      // Do nothing\n    };\n    result.quads.on('data', quad => readable.push(`${JSON.stringify(RdfString.quadToStringQuad(quad))}\\n`));\n    result.quads.on('end', () => readable.push(null));\n\n    return { stdout: readable };\n  }\n}\n\nexport interface IActorInitRdfParseArgs extends IActorArgs<IActionInit, IActorTest, IActorOutputInit> {\n  mediatorRdfDereference: Mediator<Actor<IActionRdfDereference, IActorTest, IActorRdfDereferenceOutput>,\n  IActionRdfDereference, IActorTest, IActorRdfDereferenceOutput>;\n  url?: string;\n}\n"]}